
<!DOCTYPE html>
<html>
<head>
    <title>Improving Clojure Start Time - Clojure Design - Clojure Development</title>

        

                        
    

            <meta http-equiv="X-UA-Compatible" content="IE=EDGE">
<meta charset="UTF-8">
<!-- Deprecated since 3.4. To be removed in a future version of Confluence; use AJS.Confluence.getContextPath() -->
<meta id="confluence-context-path" name="confluence-context-path" content="">
<meta id="confluence-base-url" name="confluence-base-url" content="https://dev.clojure.org">

<meta id="atlassian-token" name="atlassian-token" content="30041c830a95ce9c95d0b58cb377def6b96aa6d2">

<meta id="confluence-space-key" name="confluence-space-key" content="design">
<script type="text/javascript">
    // Deprecated global variables. To be removed in a future version of Confluence.
    var contextPath = '';
</script>

    

<!-- include system css resources -->


    <link type="text/css" rel="stylesheet" href="../../s/en_GB/3047/3/55/_/download/superbatch/css/batch.css" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/en_GB/3047/3/55/_/download/superbatch/css/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<!--[if IE 9]>
<link type="text/css" rel="stylesheet" href="/s/en_GB/3047/3/55/_/download/superbatch/css/batch.css?conditionalComment=IE+9" media="all">
<![endif]-->
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/en_GB/3047/3/55/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/en_GB/3047/3/55/_/download/superbatch/css/batch-media=print.css" media="print">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/en_GB/3047/3/961a0823b948d2f215d5a69c25b0d622/_/download/contextbatch/css/page/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/en_GB/3047/3/961a0823b948d2f215d5a69c25b0d622/_/download/contextbatch/css/page/batch.css" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/en_GB/3047/3/c80b4ecc4b1853e829650e7c54066b66/_/download/contextbatch/css/viewcontent,main/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/en_GB/3047/3/c80b4ecc4b1853e829650e7c54066b66/_/download/contextbatch/css/viewcontent,main/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/en_GB/3047/3/2.0.1/_/download/batch/com.atlassian.confluence.plugins.pagetree-pagetree-resources/com.atlassian.confluence.plugins.pagetree-pagetree-resources.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/en_GB/3047/3/3/_/styles/colors-spaceKey=design.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/en_GB/3047/3/2.0.5/_/download/resources/com.atlassian.confluence.plugins.doctheme-documentation/default-theme.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/en_GB/3047/3/2.0.5/_/download/resources/com.atlassian.confluence.plugins.doctheme-documentation/splitter.css" media="all">

<!-- end system css resources -->

    <meta name="confluence-request-time" content="1556128925255">
            <meta name="ajs-page-id" content="12845249">
            <meta name="ajs-parent-page-id" content="12845098">
            <meta name="ajs-space-key" content="design">
            <meta name="ajs-space-name" content="Clojure Design">
            <meta name="ajs-page-title" content="Improving Clojure Start Time">
            <meta name="ajs-parent-page-title" content="Release.zFuture">
            <meta name="ajs-from-page-title" content="">
            <meta name="ajs-context-path" content="">
            <meta name="ajs-version-number" content="4.0">
            <meta name="ajs-build-number" content="3047">
            <meta name="ajs-remote-user" content="">
            <meta name="ajs-static-resource-url-prefix" content="/s/en_GB/3047/3/_">
            <meta name="ajs-global-settings-attachment-max-size" content="10485760">
            <meta name="ajs-user-locale" content="en_GB">
            <meta name="ajs-enabled-dark-features" content="">
            <meta name="ajs-atl-token" content="30041c830a95ce9c95d0b58cb377def6b96aa6d2">
            
            <meta name="ajs-keyboardshortcut-hash" content="7b95af54c6deada096af1f28fdd0f413">
            <meta name="ajs-use-keyboard-shortcuts" content="true">
    <!-- Deprecated since 3.4. To be removed in a future version of Confluence; use atl.header -->
        
            <script type="text/x-template" title="share-content-popup">
    <form action="#" method="post" class="aui share-content-popup">
        <fieldset>
            <label for="users">User name or email</label>
            <div class="autocomplete-user-target">
                <input class="text autocomplete-sharepage" id="users" data-max="10" data-dropdown-target=".autocomplete-user-target" data-none-message="No matching user or email found"/>
            </div>
            <ol class="recipients">
            </ol>
            <div><label for="note">Note</label></div>
            <textarea class="textarea" id="note" placeholder="Add an optional note"/>
        </fieldset>
        <div class="button-panel">
            <div class="progress-messages-icon"></div>
            <div class="progress-messages">
            </div>
            <input class="button submit" type="submit" value="Share" disabled/>
            <a class="close-dialog" href="#">Cancel</a>
        </div>
    </form>
</script>

<script type="text/x-template" title="share-content-popup-recipient-username">
    <li data-username="{username}" style="display: none">
        <span>
            <img src="{thumbnailLink.href}" title="{title}">
            <span>{title}</span>
            <span class="remove-recipient"/>
        </span>
    </li>
</script>

<script type="text/x-template" title="share-content-popup-recipient-email">
    <li data-email="{email}" style="display: none">
        <span>
            <img src="{icon}" title="{email}">
            <span>{email}</span>
            <span class="remove-recipient"/>
        </span>
    </li>
</script>
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="icon" type="image/png" href="../../s/en_GB/3047/3/_/images/logo/confluence_16.png">

<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch/osd.action.xml" title="Clojure Development"/>

        <!-- include system javascript resources -->
                        
    
    <script type="text/javascript" src="../../s/en_GB/3047/3/55/_/download/superbatch/js/batch.js" ></script>
<!--[if lte IE 8]>
<script type="text/javascript" src="/s/en_GB/3047/3/55/_/download/superbatch/js/batch.js?conditionalComment=lte+IE+8" ></script>
<![endif]-->
<script type="text/javascript" src="../../s/en_GB/3047/3/961a0823b948d2f215d5a69c25b0d622/_/download/contextbatch/js/page/batch.js" ></script>
<script type="text/javascript" src="../../s/en_GB/3047/3/c80b4ecc4b1853e829650e7c54066b66/_/download/contextbatch/js/viewcontent,main/batch.js" ></script>
<script type="text/javascript" src="../../s/en_GB/3047/3/2.0.1/_/download/batch/com.atlassian.confluence.plugins.pagetree-pagetree-resources/com.atlassian.confluence.plugins.pagetree-pagetree-resources.js" ></script>

    
    <!-- end system javascript resources -->

    

    
    <link rel="canonical" href="Improving+Clojure+Start+Time.html">
    <link rel="shortlink" href="Improving+Clojure+Start+Time.html">
    <meta name="wikilink" content="[design:Improving Clojure Start Time]">
    <meta name="page-version" content="24">

</head>

<body             onload="placeFocus()"
     id="com-atlassian-confluence" class="theme-documentation ">
<div id="full-height-container">
    <div id="header-precursor">
        
        
                </div>

<div id="header" class="sectionbottom ">
        <form id="quick-search" class="quick-search" method="get" action="../../dosearchsite.action.html">
                <fieldset>
            <input type="hidden" name="spaceSearch" value="false"/>
        </fieldset>
        <fieldset>
            <legend>Quick Search</legend>
            <input class="quick-search-query" id="quick-search-query" type="text" accessKey="search-pages-action.accesskey" autocomplete="off" name="queryString" size="25"/>
            <input class="quick-search-submit" id="quick-search-submit" type="submit"  value="Search Confluence" />
            <div class="aui-dd-parent quick-nav-drop-down"><!-- Quick nav appears here --></div>
        </fieldset>
        <fieldset class="hidden parameters">
            <input type="hidden" id="quickNavEnabled" value="true" />
                    </fieldset>
    </form>

    <ul id="header-menu-bar" class="ajs-menu-bar">
                    
        
            <li class="normal ajs-menu-item">
        <a id="browse-menu-link" class="browse trigger ajs-menu-title" href="#"><span><span>Browse</span></span></a>         <div class="assistive ajs-drop-down">
                        <ul  id="browse-menu-link-leading"                 class="section-leading first">
                                        <li>
    
        
    
    <a  id="space-pages-link" href="../../pages/recentlyupdated.action-key=design.html"  class=""   title="Browse pages in the Clojure Design space">
                   <span>Pages</span></a>        </li>
                                        <li>
    
        
    
    <a  id="space-blogposts-link" href="../../pages/viewrecentblogposts.action-key=design.html"  class=""   title="Browse blogs in the Clojure Design space">
                   <span>Blog</span></a>        </li>
                                        <li>
    
        
    
    <a  id="space-labels-link" href="../../labels/listlabels-heatmap.action-key=design.html"  class=""   title="Browse labels in the Clojure Design space">
                   <span>Labels</span></a>        </li>
                                        <li>
    
        
    
    <a  id="space-attachments-link" href="../../spaces/listattachmentsforspace.action-key=design.html"  class=""   title="Browse attachments in the Clojure Design space">
                   <span>Attachments</span></a>        </li>
                                        <li>
    
        
    
    <a  id="space-mail-link" href="../../spaces/viewmailarchive.action-key=design.html"  class=""   title="Browse mail in the Clojure Design space">
                   <span>Mail</span></a>        </li>
                                        <li>
    
        
    
    <a  id="space-advanced-link" href="../../spaces/viewspacesummary.action-key=design.html"  class=""   title="Browse additional space functions in the Clojure Design space">
                   <span>Advanced</span></a>        </li>
                            </ul>
                        <ul  id="browse-menu-link-global"                 class="section-global">
                                        <li>
    
        
    
    <a  id="whats-new-menu-link" href="http://docs.atlassian.com/confluence/docs-40/whatsnew/iframe"  class=""   title="">
                   <span>What’s New</span></a>        </li>
                                        <li>
    
        
    
    <a  id="space-directory-link" href="../../spacedirectory/view.action.html"  class=""   title="Browse the Confluence space directory">
                   <span>Space Directory</span></a>        </li>
                                        <li>
    
        
    
    <a  id="feed-builder-link" href="../../dashboard/configurerssfeed.action.html"  class=""   title="Create your custom RSS feed.">
                   <span>Feed Builder</span></a>        </li>
                                        <li>
    
            
    
    <a  id="keyboard-shortcuts-link" href="#"  class=""   title="View available keyboard shortcuts">
                   <span>Keyboard Shortcuts</span></a>        </li>
                                        <li>
    
            
    
    <a  id="gadget-directory-link" href="#"  class="user-item administration-link"   title="Browse gadgets provided by Confluence">
                   <span>Confluence Gadgets</span></a>        </li>
                            </ul>
                    </div>
    </li>
        
                                                         <li class="ajs-menu-item normal">
        
        
    
    <a  id="login-link" href="../../login.action-os_destination=-display-design-Improving+Clojure+Start+Time.html"  class="user-item login-link"   title="">
                   <span>Log In</span></a>        </li>
                            <li class="ajs-menu-item normal">
    
        
    
    <a  id="signup-link" href="../../signup.action.html"  class="user-item signup-link"   title="">
                   <span>Sign Up</span></a>        </li>
                                <li class="normal ajs-menu-item">
            <div id="splitter-button" class="hidden" title="Show or hide sidebar"></div>
        </li>

    </ul>
    
    
    <ol id="breadcrumbs">
                    
                        
        <li class="first" >
                                    <span><a href="../../dashboard.action.html" title="Go to Dashboard">Dashboard</a></span>
                </li>
                    
                
        <li>
                                    <span><a href="Home-jsessionid=3A56E29DA520B75101350BA4484B9990.html">Clojure Design</a></span>
                </li>
                                        <li id="ellipsis" title="Show all breadcrumbs"><span><strong>&#8230;</strong></span></li>
                                    
                
        <li class="hidden-crumb" >
                                    <span><a href="Home.html">Home</a></span>
                </li>
                                
                
        <li class="hidden-crumb" >
                                    <span><a href="Release+Planning.html">Release Planning</a></span>
                </li>
                                
                
        <li class="hidden-crumb" >
                                    <span><a href="Release.zFuture.html">Release.zFuture</a></span>
                </li>
                    
                
        <li>
                                    <span><a href="Improving+Clojure+Start+Time.html">Improving Clojure Start Time</a></span>
                </li>
        </ol>

</div>

    <div id="splitter">
    <div id="splitter-sidebar" >
        

                    
        
    

<div class="plugin_pagetree">

                <div id="pagetreesearch">
            <form method="POST" action="../../dosearchsite.action-searchQuery.queryString=&amp;searchQuery.spaceKey=conf_all.html" name="pagetreesearchform">
                                    <input type="hidden" name="ancestorId" value="458775">
                                <input type="hidden" name="spaceKey" value="design">
                <input type="text"  size="20" name="queryString">
                <input type="submit" value="Search">
            </form>
        </div>
    
        
    <ul class="plugin_pagetree_children_list plugin_pagetree_children_list_noleftspace">
        <div class="plugin_pagetree_children">
        </div>
    </ul>

    <fieldset class="hidden">
        <input type="hidden" name="treeId" value="">
        <input type="hidden" name="treeRequestId" value="/plugins/pagetree/naturalchildren.action?decorator=none&amp;excerpt=false&amp;sort=position&amp;reverse=false&amp;disableLinks=false">
        <input type="hidden" name="treePageId" value="12845249">

        <input type="hidden" name="noRoot" value="false">
        <input type="hidden" name="rootPageId" value="458775">

        <input type="hidden" name="rootPage" value="">
        <input type="hidden" name="startDepth" value="0">
        <input type="hidden" name="spaceKey" value="design" >

        <input type="hidden" name="i18n-pagetree.loading" value="Loading...">
        <input type="hidden" name="i18n-pagetree.error.permission" value="Unable to load page tree. It seems that you do not have permission to view the root page.">
        <input type="hidden" name="i18n-pagetree.eeror.general" value="There was a problem retrieving the page tree. Please check the server log file for more information.">
        <input type="hidden" name="loginUrl" value="/login.action?os_destination=%2Fdisplay%2Fdesign%2FImproving%2BClojure%2BStart%2BTime">

                <fieldset class="hidden">
                                                <input type="hidden" name="ancestorId" value="12845098">
                                    <input type="hidden" name="ancestorId" value="5767475">
                                    <input type="hidden" name="ancestorId" value="458775">
                                    </fieldset>
    </fieldset>
</div>



            </div>
    <div id="splitter-content">

                    <script type="text/javascript" src="../../s/en_GB/3047/3/2.0.5/_/download/resources/com.atlassian.confluence.plugins.doctheme-resources/doc-theme.js"></script>
    
            
    
<div id="main" >
    <div id="main-header">
	    
	    
    <div id="navigation" class="content-navigation view">
                    <ul class="ajs-menu-bar">
                                
                        
            <li class="normal ajs-menu-item">
        <a id="action-menu-link" class="action trigger ajs-menu-title" href="#"><span><span>Tools</span></span></a>         <div class="assistive ajs-drop-down">
                        <ul  id="action-menu-link-primary"                 class="section-primary first">
                                        <li>
    
        
    
    <a  id="view-attachments-link" href="../../pages/viewpageattachments.action-pageId=12845249.html"  class="action-view-attachments"  accessKey="a"  title="View Attachments">
                   <span><u>A</u>ttachments (1)</span></a>        </li>
                                        <li>
    
        
    
    <a  id="action-view-history-link" href="../../pages/viewpreviousversions.action-pageId=12845249.html"  class="action-view-history"   title="">
                   <span>Page History</span></a>        </li>
                                        <li>
    
        
    
    <a  id="action-page-permissions-link" href="../../pages/viewinfo.action-pageId=12845249.html"  class="action-page-permissions"   title="Edit restrictions">
                   <span>Restrictions</span></a>        </li>
                            </ul>
                        <ul  id="action-menu-link-secondary"                 class="section-secondary">
                                        <li>
    
        
    
    <a  id="view-page-info-link" href="../../pages/viewinfo.action-pageId=12845249.html"  class="action-view-info"   title="">
                   <span>Info</span></a>        </li>
                                        <li>
    
        
    
    <a  id="link-to-page-link" href="../../pages/viewinfo.action-pageId=12845249.html"  class=""   title="Link to this Page">
                   <span>Link to this Page&hellip;</span></a>        </li>
                                        <li>
    
        
    
    <a  id="view-in-hierarchy-link" href="../../pages/listpages-dirview.action-key=design&amp;openId=12845249.html#selectedPageInHierarchy"  class=""   title="">
                   <span>View in Hierarchy</span></a>        </li>
                                        <li>
    
        
    
    <a  id="action-view-source-link" href="../../plugins/viewsource/viewpagesrc.action-pageId=12845249.html"  class="action-view-source popup-link"   title="">
                   <span>View Source</span></a>        </li>
                            </ul>
                    </div>
    </li>
            </ul>
    </div>

	    
	    <h1 id="title-heading" class="pagetitle">
	        	            <a href="Home-jsessionid=3A56E29DA520B75101350BA4484B9990.html"><img class="logo global custom" src="../../download/attachments/131074/global.logo.png" alt=""></a>	        	
			<span id="title-text">
							            <a href="Improving+Clojure+Start+Time.html">Improving Clojure Start Time</a>
    						</span>
	    </h1>
	</div>

    

    
    
    
    
    

                                                                                                                                                                                                                                                                                                                                                                                                                                                                      




        













    
    
        
    
    
                    
    

    


<div id="content" class="page view">
    



                
<script type="text/x-template" title="movePageDialog">
    <div class="row information">
        <div class="inner">
            <div class="element">
                Specify the new parent page for this page and its children by space and title.
            </div>
        </div>
    </div>
    <div class="form">
        <fieldset>
                

    <legend class="assistive"><span>Change the Parent Page to a Known Page</span></legend>
            <div class="row">
                <label for="new-space">New space:</label>
                <div class="value new-space-value">
                    <input id="new-space-key" name="new-space-key" type="hidden" value="design">
                                            <span class="space-input">
                            <input id="new-space" name="new-space" value="Clojure Design" disabled="disabled">
                        </span>
                        <span class="description warning">You cannot move this page to another space because you do not have permission to remove it from this space.</span>
                                        <div class="new-space-dropdown aui-dd-parent autocomplete"></div>
                </div>
            </div>
            <div class="row">
                <label for="new-parent-page">New parent page:</label>
                <div class="value new-parent-page-value">
                    <span class="page-input">
                        <input id="new-parent-page" name="new-parent-page" value="Release.zFuture">
                    </span>
                    <span class="description">Start typing a page title to see a list of suggestions.</span>
                    <div class="new-parent-page-dropdown aui-dd-parent autocomplete"></div>
                </div>
            </div>
        </fieldset>
    </div>
    <div class="location-info">
        <div class="row">
            <label>Current location:</label>
            <div class="value breadcrumbs-container">
                <div class="breadcrumbs-line">
                    <ul id="current-parent-breadcrumbs" class="breadcrumbs">
                    </ul>
                </div>
            </div>
        </div>
        <div class="row">
            <label>New location:</label>
            <div class="value breadcrumbs-container">
                <div class="breadcrumbs-line">
                    <ul id="new-parent-breadcrumbs" class="breadcrumbs">
                    </ul>
                </div>
            </div>
        </div>
    </div>
</script>

<script type="text/x-template" title="movePageSearchPanel">
    <div class="row information">
        <div class="inner">
            <div class="element">
                Search for and select the new parent page for this page and its children.
            </div>
        </div>
    </div>
    <div id="move-page-search-container" class="row">
        <div class="search-form">
            <fieldset>
                    

    <legend class="assistive"><span>Search for a New Parent Page</span></legend>
                    

    <label  for="move-page-search-query" class="assistive">Search keywords</label>
                <input class="search-query" id="move-page-search-query">
                    

    <label  for="move-page-search-space" class="assistive">Search in space</label>
                                    <select id="move-page-search-space" class="search-space" disabled="disabled">
                        <option value="design" selected="selected">Clojure Design</option>
                    </select>
                                <input type="button" value="Search">
                                    <div class="description warning">You cannot move this page to another space because you do not have permission to remove it from this space.</div>
                            </fieldset>
        </div>
        <div class="search-results">
        </div>
    </div>
</script>
<script type="text/x-template" title="searchResultsGrid">
    <table>
        <thead>
            <tr class="header">
                <th class="search-result-title">Page Title</th>
                <th class="search-result-space">Space</th>
                <th class="search-result-date">Updated</th>
            </tr>
        </thead>
    </table>
</script>
<script type="text/x-template" title="searchResultsGridCount">
    <p class="search-result-count">{0}</p>
</script>
<script type="text/x-template" title="searchResultsGridRow">
    <tr class="search-result">
        <th class="search-result-title"><a href="{1}" class="content-type-{2}"><span>{0}</span></a></th>
        <td class="search-result-space"><a class="space" href="/display/{4}/" title="{3}">{3}</a></td>
        <td class="search-result-date"><span class="date" title="{6}">{5}</span></td>
    </tr>
</script><!-- Start restrictions section -->
<script type="text/x-template" title="page-permissions-div">
<div id="page-permissions-div">
    <div id="page-permissions-editor-form">

                <div id="page-permissions-error-div" class="hidden">
            <a href="#" id="permissions-error-div-close">Ok</a>
            <div></div>
        </div>

                <div id="page-permissions-type-radios" class="page-permissions-label-rows">
            <div>
                <input id="restrictViewRadio" type="radio" checked="checked" name="pagePermissionTypeRadio" value="view"/>
                <label for="restrictViewRadio">Restrict viewing of this page</label>
                <input id="restrictEditRadio" type="radio" name="pagePermissionTypeRadio" value="edit"/>
                <label for="restrictEditRadio">Restrict editing of this page</label>
            </div>
        </div>
        <div id="page-permissions-input" class="page-permissions-label-rows">
            <div class="page-permissions-label">To:</div>
            <div id="page-permissions-chooser-box">
                                <span id="page-permissions-choose-user" class="ajs-button">
                    



    



<a href="#" id='userpicker-popup-link-image' onClick="var picker = window.open('/spaces/openuserpicker.action?key=design&amp;startIndex=0&amp;onPopupSubmit=AJS.PagePermissions.addUserPermissions', 'EntitiesPicker', 'status=yes,resizable=yes,top=100,left=200,width=700,height=680,scrollbars=yes'); picker.focus(); return false;"><img src="/s/en_GB/3047/3/_/images/icons/user_16.gif" height=16 width=16 border=0 align="absmiddle"  title="Choose users" /></a>
<a href="#" id='userpicker-popup-link-text' onClick="var picker = window.open('/spaces/openuserpicker.action?key=design&amp;startIndex=0&amp;onPopupSubmit=AJS.PagePermissions.addUserPermissions', 'EntitiesPicker', 'status=yes,resizable=yes,top=100,left=200,width=700,height=680,scrollbars=yes'); picker.focus(); return false;">Person...</a>


                </span>
                <span id="page-permissions-choose-group" class="ajs-button">
                    



    

 

<a href="#" id='grouppicker-popup-link-image' onClick="var picker = window.open('/spaces/opengrouppicker.action?key=design&amp;startIndex=0&amp;actionName=dosearchgroups.action&amp;onPopupSubmit=AJS.PagePermissions.addGroupPermissions', 'EntitiesPicker', 'status=yes,resizable=yes,top=100,left=200,width=580,height=550,scrollbars=yes'); picker.focus(); return false;"><img src="/s/en_GB/3047/3/_/images/icons/group_16.gif" height=16 width=16 border=0 align="absmiddle"  title="Choose groups" /></a>
<a href="#" id='grouppicker-popup-link-text' onClick="var picker = window.open('/spaces/opengrouppicker.action?key=design&amp;startIndex=0&amp;actionName=dosearchgroups.action&amp;onPopupSubmit=AJS.PagePermissions.addGroupPermissions', 'EntitiesPicker', 'status=yes,resizable=yes,top=100,left=200,width=580,height=550,scrollbars=yes'); picker.focus(); return false;">Group...</a>


                </span>
            </div>
            <div id="page-permissions-input-box">
                <input type="text" id="page-permissions-names-input" name="permissionNames"
                    placeholder="Enter user or group name" class="autocomplete-user"
                    data-max="10" data-none-message="No matches"
                    data-target="#page-permissions-names-hidden" data-template="{username}"
                    data-dropdown-target="#page-perms-name-dropdown-wrapper" data-resize-to-input="true"
                    size="30"/>
                <input
    type="hidden"
                            id="page-permissions-names-hidden"           />                <img height="16px" width="1px" src="/s/en_GB/3047/3/_/images/border/spacer.gif"/>
                <input type="button" id="add-typed-names" value="Restrict">
                <div id="page-perms-name-dropdown-wrapper" class="aui-dd-parent autocomplete"></div>
            </div>
        </div>
    </div>
    <div id="page-permissions-tables">
        <div id="page-permissions-table-div">
                        <table id="page-permissions-table" class="page-permissions-table">
                <tr id="page-permissions-no-views" class="marker-row">
                    <td colspan="3" class="page-permissions-marker-cell"><span>No view restrictions are defined for this page</span></td>
                </tr>
                <tr id="page-permissions-no-edits" class="marker-row">
                    <td colspan="3" class="page-permissions-marker-cell"><span>No edit restrictions are defined for this page</span></td>
                </tr>
            </table>
        </div>
        <div id="page-inherited-permissions-table-div" class="hidden">
            <span id="page-inherited-permissions-table-desc">
                <a class="icon twisty-closed">Show/Hide</a>
                <a id="toggle-inherited-permissions" title="Click to see inherited restrictions">This page has restricted parent pages. It can only be seen by users who can see those parent pages.</a>
            </span>
            <div id="page-inherited-permissions-tables" class="hidden page-inheritance-togglable"></div>
        </div>
    </div>
</div>
</script>

<!-- End restrictions section -->

        
    
    
        <fieldset class="hidden parameters">
            <input type="hidden" title="parentPageId" value="12845098">
        </fieldset>

        
                            
    

                    

        
        <a href="#page-metadata-end" class="assistive">Skip to end of metadata</a>
<div id="page-metadata-start" class="assistive"></div>

    <div class="page-metadata">
        <ul>
                            <li class="page-metadata-item noprint">
    
            
    
    <a  id="content-metadata-page-restrictions" href="#"  class="page-metadata-icon page-restrictions hidden"   title="Page restrictions apply. Click the lock icon to view or edit the restriction.">
                   <span>Page restrictions apply</span></a>        </li>
                            <li class="page-metadata-item noprint">
    
        
    
    <a  id="content-metadata-attachments" href="../../pages/viewpageattachments.action-pageId=12845249&amp;metadataLink=true.html"  class="page-metadata-icon action-view-attachments"  accessKey="a"  title="Attachments: 1">
                   <span><span class="page-metadata-attachments-text">Attachments:</span><span class="page-metadata-attachments-count">1</span></span></a>        </li>
                        <li class="page-metadata-modification-info">
                                    Added by <a href="../../login.action-os_destination=-display-~alexmiller.html"
                          class="url fn"
                   >Alex Miller</a>, last edited by <a href="../../login.action-os_destination=-display-~alexmiller.html"
                          class="url fn"
                   >Alex Miller</a> on Feb 24, 2016
                                                                <span class="noprint">&nbsp;(<a id="view-change-link" href="../../pages/diffpages.action-pageId=12845249&amp;originalId=13107284.html">view change</a>)</span>
                                                </li>
                    </ul>
                </div>


<a href="#page-metadata-start" class="assistive">Go to start of metadata</a>
<div id="page-metadata-end" class="assistive"></div>
        
        <fieldset class="hidden parameters">
                        <input type="hidden" title="browsePageTreeMode" value="view">
        </fieldset>

        <div class="wiki-content">
                           <h2 id="ImprovingClojureStartTime-Problem"><span>Problem</span></h2><p><span>Slow Clojure boot time is frequently one of the highest ranked issues in the annual State of Clojure survey. A separate poll showed that many people are experiencing slow boot times in a variety of circumstances - not just when trying to use Clojure for &quot;scripting&quot;, but also when starting a REPL or running a Clojure program in a variety of ways.</span></p><h3 id="ImprovingClojureStartTime-Goals">Goals</h3><p>In Jan, 2016 an informal poll collected startup time data from ~100 users. This data was incomplete and anecdotal but the following summarizes the essence of what was reported:</p><ul><li><strong>Starting a REPL with lein repl</strong>(most frequent reported use case)<ul><li>50% - reported 2-10 second start times (expected: 1-2 s)</li><li>30% - reported 20-30 second start times (expected: 2-5 s)</li><li>20% - reported 60+ second start times (expected: 2-15 s)</li></ul></li><li><strong>Starting Clojure program with lein run</strong><ul><li>50% - reported 2-6 seconds (expected: &lt;1 s)</li><li>rest - reported 10-60 seconds</li></ul></li><li><strong>Starting Clojure program with java command</strong><ul><li>50% reported 2-5 seconds (expected: &lt;1 s)</li><li>rest - reported 10-60 seconds (expected: 3-5 s)</li></ul></li></ul><p>There are a variety of different use cases where we would like to see progress:</p><ul><li><strong>Reduce clojure.core startup overhead</strong>- this helps everyone, but would be most felt in starting the REPL or running small, short-lived programs<ul><li>Given the 94 ms of Java startup time, we will never compete directly with interpreted langs</li><li>Currently the Clojure boot time is about 640 ms - a good goal would be <strong>400 ms </strong>(in addition to the Java startup time) </li></ul></li><li><strong>Reduce tooling startup time</strong>(lein/boot startup)<ul><li>While this has nothing to do with Clojure core, it is nevertheless the biggest component of start time for small projects</li><li>lein repl should start in 1 second - if we can get JVM/Clojure overhead to &lt; 0.5 s, then this means lein repl has to happen in 0.5 s</li><li>Starting nrepl is the biggest factor in the startup time</li><li>Impoving startup time helps twice as lein repl launches a second JVM</li></ul></li><li><span><strong>Reduce time per-ns and per-var</strong> to improve large program start time</span></li><ul><li>While there is fixed overhead, the majority of the costs scale with the number of namespaces and number of vars</li><li>The per-var cost is a key factor contributing to startup time for larger apps which load a significant number of vars<ul><li>Lazy vars have the biggest potential here, but also optimizing the process of creating and binding vars</li><li>We need to cut this cost to the realm of 0.1 ms/var instead</li></ul></li></ul></ul><p>Raw startups for other dynamic langs (20-30 ms):</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">Command</th><th class="confluenceTh">Time (s)</th></tr><tr><td class="confluenceTd">ruby -e 0</td><td class="confluenceTd">0.031</td></tr><tr><td class="confluenceTd">python -c 0</td><td class="confluenceTd">0.019</td></tr><tr><td colspan="1" class="confluenceTd">node -e 0</td><td colspan="1" class="confluenceTd">0.027</td></tr></tbody></table></div><h3 id="ImprovingClojureStartTime-Timings"><span>Timings</span></h3><p><span>The startup time that people experience can be broken into several pieces:</span></p><ul><li><span style="font-size: 10.0pt;line-height: 13.0pt;">JVM startup</span></li><li><span style="font-size: 10.0pt;line-height: 13.0pt;">Clojure runtime startup, biggest pieces are:</span><ul><li>clojure.lang.RT</li><li>clojure.core namespace</li></ul></li><li>Tooling startup - t<span style="font-size: 10.0pt;line-height: 13.0pt;">ools like Leiningen or Boot add significant overhead</span><ul><li>Starting nrepl server</li><li>Connecting to nrepl with client (like reply)</li><li>Initializing middleware, most critically clojure-complete, which scans jars</li></ul></li><li>Program load time</li><ul><li>Each namespace you load in starting your program has a cost:<ul><li>Compilation (if source)</li><li>Var loading (per var)</li><li>Class loading (per function)</li></ul></li><li>Whatever actual logic you run at startup time</li></ul></ul><h3 id="ImprovingClojureStartTime-Howdoesthisbreakdownforanexampleprogram">How does this break down for an example program?</h3><p>Timings done with:</p><ul><li>Java 1.8 - Java HotSpot(TM) 64-Bit Server VM (build 25.74-b02, mixed mode)</li><li>Clojure 1.8.0</li><li>Leiningen 2.6.1</li><li>Boot 2.5.5</li><li>Macbook Pro - Quad core 2.7 GHz Intel Core i7, 16 GB 1600 MHz DDR3, SSD</li><li>Times reported are best of 5 runs</li></ul><p> </p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" class="confluenceTh">ID</th><th class="confluenceTh">Command</th><th class="confluenceTh">Program</th><th class="confluenceTh">Time (seconds)</th><th colspan="1" class="confluenceTh">Classes loaded</th></tr><tr><td colspan="1" class="confluenceTd">J-NIL</td><td class="confluenceTd">java -cp java Hello</td><td class="confluenceTd">Java empty main</td><td class="confluenceTd">0.09</td><td colspan="1" class="confluenceTd">423</td></tr><tr><td class="confluenceTd">C-NIL</td><td class="confluenceTd"><span>java -cp $CLOJURE18 clojure.main -e nil</span></td><td class="confluenceTd"><span>Clojure eval nil</span></td><td class="confluenceTd">0.73</td><td class="confluenceTd">1996</td></tr><tr><td colspan="1" class="confluenceTd">C-REPL</td><td class="confluenceTd">echo | time java -cp $CLOJURE18 clojure.main</td><td class="confluenceTd">Clojure REPL start/stop</td><td class="confluenceTd">0.89</td><td colspan="1" class="confluenceTd">2389</td></tr><tr><td colspan="1" class="confluenceTd">C-RUN</td><td colspan="1" class="confluenceTd">java -cp $CLOJURE18:src clojure.main -e &quot;(require 'hello.main) (hello.main/hi)&quot;</td><td colspan="1" class="confluenceTd">Run function in a ns</td><td colspan="1" class="confluenceTd">0.80</td><td colspan="1" class="confluenceTd">2078</td></tr><tr><td colspan="1" class="confluenceTd">C-RUN-2</td><td colspan="1" class="confluenceTd"><span>java -cp $CLOJURE18:src clojure.main -e &quot;(require 'hello.main2) (hello.main2/hi)&quot;</span></td><td colspan="1" class="confluenceTd">main2 loads 2nd ns with 100 defns</td><td colspan="1" class="confluenceTd">0.87</td><td colspan="1" class="confluenceTd">2184</td></tr><tr><td colspan="1" class="confluenceTd">C-AOT</td><td colspan="1" class="confluenceTd">java -cp $CLOJURE18:target/classes hello.core</td><td colspan="1" class="confluenceTd">Run empty fn with AOT</td><td colspan="1" class="confluenceTd">0.74</td><td colspan="1" class="confluenceTd">1997</td></tr></tbody></table></div><p>Diffing these we can estimate these costs by diffing the times above:</p><ul><li>JVM startup = 90 ms (423 classes) - we can take this as a minimum bar</li><li>Clojure runtime startup = 640 ms (1573 classes) - C-NIL vs J-NIL</li><li>Clojure REPL startup = 160 ms (393 classes) - C-REPL vs C-NIL</li><li>Loading 1 namespace with 1 defn = 70 ms (82 classes) - C-RUN vs C-NIL</li><li>Requiring namespace containing 100 defns = 70 ms (106 classes) - C-RUN-2 vs C-RUN</li></ul><p>If we AOT compile a Clojure namespace and invoke the compiled form directly, we see a reduction of 60 ms and 81 classes. These programs are too simple to evaluate the impact of JIT vs AOT.</p><h3 id="ImprovingClojureStartTime-Leiningenoverhead">Leiningen overhead</h3><p>We can also look at the lein repl overhead for the commands above.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr class="confluenceTr"><th colspan="1" class="confluenceTh">ID</th><th class="confluenceTh">Command</th><th class="confluenceTh">Program</th><th class="confluenceTh">Time (seconds)</th><th colspan="1" class="confluenceTh">Classes loaded</th><th colspan="1" class="confluenceTh">Vs C- (sec)</th><th colspan="1" class="confluenceTh">Vs C- (classes)</th></tr><tr><td class="confluenceTd">L-REPL</td><td class="confluenceTd">echo | time lein repl</td><td class="confluenceTd">Clojure REPL start/stop</td><td class="confluenceTd">4.54</td><td class="confluenceTd">3383</td><td colspan="1" class="confluenceTd">0.89</td><td colspan="1" class="confluenceTd">2389</td></tr><tr><td class="confluenceTd">L-RUN</td><td class="confluenceTd">lein run -m hello.main/hi</td><td class="confluenceTd">Run function in a ns</td><td class="confluenceTd">2.50</td><td class="confluenceTd">2104</td><td colspan="1" class="confluenceTd">0.80</td><td colspan="1" class="confluenceTd">2078</td></tr><tr><td class="confluenceTd">L-RUN-2</td><td class="confluenceTd">lein run -m hello.main2/hi</td><td class="confluenceTd">main2 loads 2nd ns with 100 defns</td><td class="confluenceTd">2.54</td><td class="confluenceTd">2306</td><td colspan="1" class="confluenceTd">0.87</td><td colspan="1" class="confluenceTd">2184</td></tr><tr class="confluenceTr"><td colspan="1" class="confluenceTd">L-AOT</td><td colspan="1" class="confluenceTd">lein run -m hello.core</td><td colspan="1" class="confluenceTd">run AOT fn</td><td colspan="1" class="confluenceTd">2.51</td><td colspan="1" class="confluenceTd">2185</td><td colspan="1" class="confluenceTd">0.74</td><td colspan="1" class="confluenceTd">1997</td></tr></tbody></table></div><p>When running Leiningen repl, we see 3.65 sec of additional time and almost 1000 additional classes loaded.</p><p>When running Leiningen run, we see about 1.8 s of additional time added.</p><p>Both of these commands are using nrepl. <span style="font-size: 10.0pt;line-height: 13.0pt;">Looking closer at the nrepl startup, we see that it takes:</span></p><ul><li>1.6 s to start the nrepl server (this involves launching a second JVM)</li><li>0.2 s to start the nrepl client</li></ul><p>These cannot currently be parallelized do to race conditions in nrepl-ack (according to the code). </p><p>There are other options for starting lein repl faster with fast trampoline. You can use this as follows (all times are after initial run which caches classpath etc):</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">ID</th><th class="confluenceTh">Command</th><th class="confluenceTh">Time (seconds)</th><th colspan="1" class="confluenceTh">Vs L- (sec)</th></tr><tr><td class="confluenceTd">LFT-REPL</td><td class="confluenceTd"><span>LEIN_FAST_TRAMPOLINE=y echo | lein trampoline run -m clojure.main<br /><em>Note: using Clojure REPL, not lein repl</em></span></td><td class="confluenceTd">2.42</td><td colspan="1" class="confluenceTd">4.54</td></tr><tr><td colspan="1" class="confluenceTd">LFT-RUN</td><td colspan="1" class="confluenceTd"><span><span>LEIN_FAST_TRAMPOLINE=y </span>lein <span>trampoline </span>run -m hello.main/hi</span></td><td colspan="1" class="confluenceTd">0.81</td><td colspan="1" class="confluenceTd">2.50</td></tr><tr><td colspan="1" class="confluenceTd">LFT-RUN-2</td><td colspan="1" class="confluenceTd"><span><span>LEIN_FAST_TRAMPOLINE=y </span>lein <span>trampoline </span>run -m hello.main2/hi</span></td><td colspan="1" class="confluenceTd">0.83</td><td colspan="1" class="confluenceTd">2.54</td></tr><tr><td class="confluenceTd">LFT-AOT</td><td class="confluenceTd">LEIN_FAST_TRAMPOLINE=y lein trampoline run -m hello.core</td><td class="confluenceTd">0.80</td><td colspan="1" class="confluenceTd">2.51</td></tr></tbody></table></div><p>These run times are essentially as fast as not using lein at all after the first invocation. <span style="font-size: 10.0pt;line-height: 13.0pt;">However, most people don't do this because this is more complicated.</span></p><h3 id="ImprovingClojureStartTime-clojurecoreloading">clojure.core loading</h3><p>clojure.core defines all of the core vars in the Clojure language. clojure.core is actually split up across a number of files, many of which are loaded from core.clj. We can put some numbers on the time to load each part:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">part</th><th class="confluenceTh">ms</th></tr><tr><td class="confluenceTd">core, pt 1</td><td class="confluenceTd">216</td></tr><tr><td class="confluenceTd">core_proxy</td><td class="confluenceTd">8</td></tr><tr><td class="confluenceTd">core_print</td><td class="confluenceTd">23</td></tr><tr><td class="confluenceTd">genclass</td><td class="confluenceTd">12</td></tr><tr><td class="confluenceTd">core_deftype</td><td class="confluenceTd">15</td></tr><tr><td class="confluenceTd">core/protocols</td><td class="confluenceTd">24</td></tr><tr><td class="confluenceTd">gvec</td><td class="confluenceTd">10</td></tr><tr><td class="confluenceTd">instant</td><td class="confluenceTd">21</td></tr><tr><td class="confluenceTd">uuid</td><td class="confluenceTd">6</td></tr><tr><td class="confluenceTd">core, pt 2</td><td class="confluenceTd">79</td></tr><tr><td class="confluenceTd">core, pt 3 - datareaders</td><td class="confluenceTd">8</td></tr></tbody></table></div><p>gvec is initialized during load but is not actually used by anything during load - this startup could potentially happen in parallel or lazily. This would save at most 10 ms.</p><p>instant and uuid are fairly independent chunks of code that don't need to be loaded until the data readers are read at the very end of core - they could potentially be loaded in parallel as well. This would save at most 21 ms though.</p><p>Clearly though the majority of these times correspond to loading each var in core - there is a per-var cost on the order of a few tenths of a ms.</p><h3 id="ImprovingClojureStartTime-RTloading">RT loading</h3><p>clojure.lang.RT is the other major component of Clojure runtime load time. How does it break down?</p><p>TODO</p><h3 id="ImprovingClojureStartTime-Per-varloadtime">Per-var load time</h3><p>It is common for people to report server load times in the order of 10s of seconds with a total load time over a minute. While there is likely little to do with respect to an application's logic, t<span>here is a per-var cost (due to definition, initialization, and classloading). Could dramatic improvements to per-var loading make significant changes to load time? Lazy var loading is one approach to this, but there are potentially other improvements that could help as well (optimizing Var.bindRoot or even using something lighter weight than vars).</span></p><h3 id="ImprovingClojureStartTime-Examininganexampleprogram"><span>Examining an example program</span></h3><p>This section analyzes a larger &quot;real&quot; program, the Luminus <a href="https://github.com/luminus-framework/guestbook" class="external-link" rel="nofollow">Guestbook</a> example app (forked <a href="https://github.com/puredanger/guestbook" class="external-link" rel="nofollow">here</a> to maintain a stable build with some mods). This is a fairly typical Clojure web app using many of the most popular libraries for its implementation. The app was modified to System/exit as soon as the main starts so we are primarily measuring boot time.</p><p><strong>1) What are some timings for various ways to run the guestbook app?</strong></p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">ID</th><th class="confluenceTh">Command</th><th colspan="1" class="confluenceTh">Description</th><th class="confluenceTh">Time (s)</th><th class="confluenceTh">Classes loaded</th></tr><tr><td class="confluenceTd">GB-C-JIT</td><td class="confluenceTd">time java -cp `cat cp` clojure.main -m guestbook.core</td><td colspan="1" class="confluenceTd">no lein, no aot</td><td class="confluenceTd">9.57 s</td><td class="confluenceTd">10494</td></tr><tr><td class="confluenceTd">GB-C-AOT</td><td class="confluenceTd">time java -jar target/guestbook.jar</td><td colspan="1" class="confluenceTd">no lein, aot</td><td class="confluenceTd">4.67 s</td><td class="confluenceTd">7344</td></tr><tr><td colspan="1" class="confluenceTd">GB-C-AOT-DL</td><td colspan="1" class="confluenceTd"><span>time java -jar target/guestbook.jar</span></td><td colspan="1" class="confluenceTd">no lein, aot + direct linking</td><td colspan="1" class="confluenceTd">4.59 s</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">GB-L-JIT</td><td colspan="1" class="confluenceTd">time lein run </td><td colspan="1" class="confluenceTd">lein, no aot</td><td colspan="1" class="confluenceTd">13.43 s</td><td colspan="1" class="confluenceTd">10550</td></tr><tr><td colspan="1" class="confluenceTd">GB-L-AOT</td><td colspan="1" class="confluenceTd">time lein run</td><td colspan="1" class="confluenceTd">lein, aot</td><td colspan="1" class="confluenceTd">6.98 s</td><td colspan="1" class="confluenceTd">7482</td></tr><tr><td colspan="1" class="confluenceTd">GB-L-REPL</td><td colspan="1" class="confluenceTd">echo | time lein repl</td><td colspan="1" class="confluenceTd">repl</td><td colspan="1" class="confluenceTd">13.99 s</td><td colspan="1" class="confluenceTd">10508</td></tr></tbody></table></div><p><strong>2) For non-AOT, is reading/compilation a dominant factor?</strong></p><p>Yes - <strong>about half</strong> the time is spent in compilation (based on comparison to AOT).</p><p><strong>3) Do lazy vars improve AOT times?</strong> </p><p><span>As tested, this affects both Clojure jar itself and the guestbook uberjar.</span></p><div class="table-wrap"><table class="confluenceTable"><tbody><tr class="confluenceTr"><th class="confluenceTh">ID</th><th class="confluenceTh">Command</th><th colspan="1" class="confluenceTh">Description</th><th class="confluenceTh">Time (s)</th><th class="confluenceTh">Classes loaded</th></tr><tr class="confluenceTr"><td class="confluenceTd">GB-C-AOT-LAZY</td><td class="confluenceTd">time java -jar target/guestbook.jar</td><td colspan="1" class="confluenceTd">no lein, aot, lazy</td><td class="confluenceTd">3.88 s (17% improved)</td><td class="confluenceTd">4440</td></tr><tr class="confluenceTr"><td colspan="1" class="confluenceTd">GB-L-AOT-LAZY</td><td colspan="1" class="confluenceTd">time lein run</td><td colspan="1" class="confluenceTd">lein, aot, lazy</td><td colspan="1" class="confluenceTd">6.51 s (7% improved)</td><td colspan="1" class="confluenceTd">4611</td></tr></tbody></table></div><p>Yes - lazy vars improve startup time 10-20%.</p><p><strong>4) What is the Lein overhead?</strong></p><p>The lein run overhead with AOT was 2.31 s, slightly bigger than we saw in L-AOT.</p><p>The lein run overhead with no AOT was 3.86 s, bigger than we saw in <span>L-RUN and L-RUN-2 (overhead was about the same there).</span><span style="font-size: 10.0pt;line-height: 13.0pt;"> </span></p><p><strong>5) For Lein, is some kind of classpath calculation caching worth doing?</strong></p><p>Lein fast trampoline will cache the command startup and avoid the first lein execution.</p><p>Lein run AOT + LEIN_FAST_TRAMPOLINE: 7.00 s (about the same) - surprised this wasn't a couple seconds faster</p><p>Lein repl + LEIN_FAST_TRAMPOLINE:  8.58 s (39% improved) - why is this so much better than the lein run?</p><p><strong>6) Why are lein repl times so much bigger than lein repl on a simple project and for lein run?</strong></p><p>TODO</p><p><strong>7) How big an impact is AOT compiling lein dependencies (like tools.nrepl)?</strong></p><p>TODO</p><p><strong>8) How big an impact is AOT compiling project dependencies?</strong></p><p>TODO</p><h2 id="ImprovingClojureStartTime-Techniquesforfasterloads">Techniques for faster loads</h2><p><span>This section discusses techniques available now to reduce load times.</span></p><h3 id="ImprovingClojureStartTime-JVMArgs"><span>JVM Args</span></h3><p><span>The following JVM startup args may improve startup performance (note that some of these have important tradeoffs though):</span></p><ul><li><span>-client -XX:+TieredCompilation -XX:TieredStopAtLevel=1 </span><ul><li><span>These settings use the client compiler and use one the 1st stage compiler to favor faster start time. </span></li><li><span>These settings prevent JIT compilation to get the highest level of performance over time, so you should only use these settings when running a REPL or short-running apps. Long-running server programs should not use these settings.</span></li></ul></li><li><span>-Xverify:none</span><ul><li><span>Suppresses the bytecode verifier (which speeds classloading). </span></li><li><span>Enabling this option introduces a <a href="https://blogs.oracle.com/buck/entry/never_disable_bytecode_verification_in" class="external-link" rel="nofollow">security risk</a> from malicious bytecode, so should be carefully considered.</span></li></ul></li><li><span>-XX:+AggressiveOpts</span></li><ul><li><span>This option enables optimizations that are not yet enabled by default but will be in the next version of the JDK. Generally this option improves performance for any program and is safe to use.</span></li></ul></ul><p>You should also consider your heap settings. If you can anticipate the max heap you expect to use then setting the min and max heap to that value will allow the JVM to do a single memory allocation rather than growing the heap during startup. Some experimentation may be required to determine the optimal values for this. For example:  -Xms256m -Xmx256m</p><h3 id="ImprovingClojureStartTime-AOTcompilation"><span>AOT compilation</span></h3><p>When starting a Clojure program, any Clojure code that is loaded from a source file (.clj or .cljc) must be compiled. The Clojure compiler is fast, but it's a significant source of load time. Consider AOT compilation any time you expect to start the same instance of a program many times (without changing the source).</p><p>Most build tools (lein, boot, etc) provide the ability to <a href="../../../clojure.org/reference/compilation.html" class="external-link" rel="nofollow">compile</a> your Clojure source ahead-of-time (AOT) to .class files. AOT is transitive (all source namespaces needed will be compiled) however distributing AOT compiled libraries that contain compiled versions of dependencies is a bad idea and will create version problems for downstream consumers - for this reason, most libraries are distributed as source and this is recommended. It is typically best to AOT compile when you build a final application (when creating an uberjar or war for deployment, for example). </p><p>The default Clojure jar is distributed in AOT compiled form.</p><h3 id="ImprovingClojureStartTime-Elidingmetadata"><span>Eliding metadata</span></h3><p><span>When compiling, each function is compiled into a class. Metadata (like the docstring) is included into that compiled class file and stored as a constant in the constant pool. Metadata like the docstring is typically not used except when developing at the REPL. The Clojure compiler can be instructed to <a href="../../../clojure.org/reference/compilation.html#_elide_meta" class="external-link" rel="nofollow">elide</a> that meta, removing it from the compiled class. This reduces class size and improves classloading.</span></p><p>Using a Clojure jar compiled with metadata elided reduces load time <strong>5-15 ms</strong>. For large AOT'ed Clojure apps with a lot of docstrings, there could be some impact as well, but it's estimated that the impact is small.</p><h3 id="ImprovingClojureStartTime-Directlinking"><span>Direct linking</span></h3><p><span>Var invocation involves looking up a var, retrieving it's function, and invoking it. <a href="../../../clojure.org/reference/compilation.html#directlinking" class="external-link" rel="nofollow">Direct linking</a> shortcuts this by compiling into a direct static invocation of the function class. When direct linking is enabled, the Clojure compiler is enable to avoid initializing many of the vars, so the class size is reduced and classloading is improved. Since Clojure 1.8, the default clojure jar is compiled with direct linking.</span></p><p><span><br /></span></p><h2 id="ImprovingClojureStartTime-Smallimprovements">Small improvements</h2><p>This section describes smaller fixes or enhancements that can be done to reduce load time. Most of these are linked to tickets with patches.</p><h3 id="ImprovingClojureStartTime-Delaysocketserverloading">Delay socket server loading</h3><p>In 1.8, new code was added to runtime startup to check for socket server Java system properties and start a socket server for each one found. However, this code is causing several namespaces to be loaded (clojure.core.server, clojure.edn) even when no socket servers are defined (the common case).</p><p>A patch to address this issue is available at <a href="../../jira/browse/CLJ-1891.html" class="external-link" rel="nofollow">CLJ-1891</a>. <span style="font-size: 10.0pt;line-height: 13.0pt;">Applying the patch reduces Clojure core start time about <strong>20 ms</strong>.</span></p><h3 id="ImprovingClojureStartTime-Reducereferoverhead"><span>Reduce `refer` overhead</span></h3><p><span>Each time a new namespace is loaded, it will &quot;refer&quot; external vars into the namespace. This happens for clojure.core automatically and will also happen due to the use of `use` or `require` with `refer`. The current implementation of refer is not very efficient - it builds large intermediate maps, traverses all vars even when only a few are refer'ed, and cas'es each new var into the namespace individually. The patch at <a href="../../jira/browse/CLJ-1730.html" class="external-link" rel="nofollow">CLJ-1730</a> address the worst of these issues while still taking a relatively conservative approach in the changes. This reduces the cost of refer-clojure (done on the load of every new ns) by about 50% and the time for :refer :only by as much as 90%. However this is only a small percentage of typical load times which are dominated by var initialization and classloading.</span></p><h3 id="ImprovingClojureStartTime-Checkelide-metainadd-doc-and-meta">Check elide-meta in add-doc-and-meta</h3><p>The add-doc-and-meta function is used to attach docs later in clojure.core load, but this macro does not currently check whether the doc meta will be elided. A check in the macro could turn these into no-ops, saving some time.</p><h3 id="ImprovingClojureStartTime-OptimizeVarbindRoot"><span>Optimize Var.bindRoot()</span></h3><p><span>This is called close to 1000 times on clojure.core start - it could potentially be optimized wrt watches, validation, and meta (optimize alterMeta wrt clearing macro flag).</span></p><h3 id="ImprovingClojureStartTime-ReduceRTandclojurecoreloadtime"><span>Reduce RT and clojure.core load time</span></h3><p><span>There are likely a number of changes that could be made in RT (and clojure.core) initialization to reduce load times:</span></p><ul><li><span>When creating symbols and keywords, call the two arg fn with nil namespace, rather than the single arg form (which must analyze the string)</span></li><ul><li><span style="font-size: 10.0pt;line-height: 13.0pt;">Symbol.intern(&quot;foo&quot;) should be Symbol.intern(null, &quot;foo&quot;)</span></li></ul><li><span style="font-size: 10.0pt;line-height: 13.0pt;">Intern common strings like: clojure.core, column, arglists, x, tag, &amp;, coll, etc</span></li><li>When loading auto-imported java.lang classes, don't load the classes, just get the unloaded class instance</li><li>Remove {:static true} meta - no longer used</li><li>Remove {:added &quot;1.0&quot;} and make that the default &quot;added&quot; assumption.</li><li>Parallelize loading of gvec, instant, and uuid - these are mutually exclusive and don't interact much with the rest of core.</li></ul><p>These need further testing to determine whether they are worth doing.</p><p> </p><h2 id="ImprovingClojureStartTime-BigImprovements"><span>Big Improvements</span></h2><p><span>This section discusses larger changes that could have a more significant impact on start time.</span></p><h3 id="ImprovingClojureStartTime-Reducereadertime"><span>Reduce reader time</span></h3><p><span>For non-AOT (common during dev/repl), reading is a significant time factor.</span></p><h3 id="ImprovingClojureStartTime-Reducecompiletime"><span>Reduce compile time</span></h3><p><span><span>For non-AOT (common during dev/repl), compiling is a significant time factor.</span></span></p><h3 id="ImprovingClojureStartTime-Lazyvars"><span>Lazy vars</span></h3><p>Most of this time is taken in loading and initializing vars, largely functions. The time is spent in classloading the function under the var, loading metadata from the constant pool, and initializing the vars.</p><p>Many of these vars are not actually needed to start a program - clojure.core in Clojure 1.8 has 725 interned vars but a large number of them are unused for most programs at startup time. Delaying the loading of these vars until they are needed would yield significant performance gains. Attached to this page is a patch (lazyvars.diff) adapted from Rich's prior work on the fastload branch of Clojure.</p><p> </p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">ID</th><th class="confluenceTh">Before patch (s)</th><th colspan="1" class="confluenceTh">Before Classes</th><th class="confluenceTh">After patch (s)</th><th colspan="1" class="confluenceTh">After classes</th></tr><tr><td class="confluenceTd">C-NIL</td><td class="confluenceTd">0.73</td><td colspan="1" class="confluenceTd">1996</td><td class="confluenceTd">0.53 (-27%)</td><td colspan="1" class="confluenceTd">1175 (-41%)</td></tr><tr><td class="confluenceTd"><p>C-REPL</p></td><td class="confluenceTd">0.89</td><td colspan="1" class="confluenceTd">2389</td><td class="confluenceTd">0.64 (-28%)</td><td colspan="1" class="confluenceTd">1350 <span>(-43%)</span></td></tr><tr><td class="confluenceTd">C-RUN</td><td class="confluenceTd">0.80</td><td colspan="1" class="confluenceTd">2078</td><td class="confluenceTd">0.60 (-25%)</td><td colspan="1" class="confluenceTd">1271 <span>(-39%)</span></td></tr><tr><td colspan="1" class="confluenceTd">C-RUN-2</td><td colspan="1" class="confluenceTd">0.87</td><td colspan="1" class="confluenceTd">2184</td><td colspan="1" class="confluenceTd">0.68 (-22%)</td><td colspan="1" class="confluenceTd">1378 <span>(-37%)</span></td></tr><tr><td colspan="1" class="confluenceTd">C-AOT</td><td colspan="1" class="confluenceTd">0.74</td><td colspan="1" class="confluenceTd">1997</td><td colspan="1" class="confluenceTd">0.53 (-28%)</td><td colspan="1" class="confluenceTd">1163 (-42%)</td></tr><tr><td colspan="1" class="confluenceTd">L-REPL</td><td colspan="1" class="confluenceTd">4.54</td><td colspan="1" class="confluenceTd">3383</td><td colspan="1" class="confluenceTd">4.52 (-0.4%)</td><td colspan="1" class="confluenceTd">2454 (-27%)</td></tr><tr><td colspan="1" class="confluenceTd">L-RUN</td><td colspan="1" class="confluenceTd">2.50</td><td colspan="1" class="confluenceTd">2104</td><td colspan="1" class="confluenceTd">2.45 (-2.0%)</td><td colspan="1" class="confluenceTd">1307 (-38%)</td></tr><tr><td colspan="1" class="confluenceTd">L-RUN-2</td><td colspan="1" class="confluenceTd">2.54</td><td colspan="1" class="confluenceTd">2306</td><td colspan="1" class="confluenceTd">2.50 (-1.6%)</td><td colspan="1" class="confluenceTd">1414 (-39%)</td></tr><tr><td colspan="1" class="confluenceTd">L-AOT</td><td colspan="1" class="confluenceTd">2.51</td><td colspan="1" class="confluenceTd">2185</td><td colspan="1" class="confluenceTd">2.44 (-2.8%)</td><td colspan="1" class="confluenceTd">1375 (-37%)</td></tr></tbody></table></div><p>With lazily loaded vars we are seeing a significant reduction in both time and classes loaded for the Clojure runtimes but only slight improvements in the Leiningen runtimes (even though we see similar class reduction). This implies that while lazy vars do make a significant difference in Clojure start time, those gains are dwarfed by other parts of Leiningen start time. </p><p>One downside of lazy vars is that the JIT is not as good at inlining through the lazy var check which makes var indirection slower after the lazy var has been forced. One open question is whether invokedynamic changes this, possibly allowing this to be the default.</p><p><a href="http://mail.openjdk.java.net/pipermail/mlvm-dev/2014-August/005890.html" class="external-link" rel="nofollow">John Rose on using indy for startup</a></p><p> </p><h3 id="ImprovingClojureStartTime-Parallelnamespaceloading">Parallel namespace loading</h3><p> </p><p><span><br /></span></p>
    
        </div>

        <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
         <rdf:Description
    rdf:about="https://dev.clojure.org/display/design/Improving+Clojure+Start+Time"
    dc:identifier="https://dev.clojure.org/display/design/Improving+Clojure+Start+Time"
    dc:title="Improving Clojure Start Time"
    trackback:ping="https://dev.clojure.org/rpc/trackback/12845249"/>
</rdf:RDF>
-->

        <script type="text/x-template" title="labels-dialog-div">

    
    <div id="labels-dialog">
        <div class="labels-editor">
            <span class="errorMessage error" id="errorSpan"></span>
            <form method="GET" action="" id="add-labels-form">
                <div id="labelOperationErrorContainer">
                    <span class="error"><span class="errorMessage" id="labelOperationErrorMessage"></span></span>
                </div>
    
                <div class="caption">Enter labels to add to this page:</div>
                <div id="label-input-fields">
                    <input autocomplete="off" id="labelsString" name="labelsString" value="">
                    <input id="add-labels-editor-button" type="submit" class="add-labels" value="Add">
                </div>
                <div id="labelsAutocompleteList" class="aui-dd-parent resize-to-input" style="width: 417px"></div>
                <div id="dialog-label-list">
                    <span id="labels-section-title-none" class="no-labels-message" >
None
</span>
<ul class="label-list">
</ul>
                </div>
                <div id="waitImageAndStatus">
                    <img class="waiting" alt="Please wait" src="/s/en_GB/3047/3/_/images/icons/wait.gif">&nbsp;
                    <span id="labelOperationStatus" class="smalltext"></span>
                </div>
                <div class="labels-tip"></div>
            </form>
        </div>
    </div>
</script>
            
    


<div id="labels-section" class="pageSection group">
    <div class="labels-editor">
        <span id="labels-section-title" class="label-title">Labels:</span>
        <div id="labels-section-content" class="content-column">
            <span id="labels-section-title-none" class="no-labels-message" >
None
</span>
<ul class="label-list">
</ul>

                            <a id="labels-edit" href="#" class="show-labels-editor editor-icon" title="Edit Labels">
                    <span class="icon icon-edit">Edit Labels</span>
                </a>
                    </div>
    </div>
</div>

            
            




            
    







<div id="comments-section" class="pageSection group">
    
            <div class="section-header ">
            <h2 id="comments-section-title" class="section-title">
                <a href="#" class="comments-show-hide comments-showing" name="comments">
                                            4 Comments
                                    </a>
            </h2>
            <a title="Hide/Show Comments" href="#" 
               class="comments-show-hide icon comments-showing icon-section-opened">
                Hide/Show Comments
            </a>
        </div>
    
    
                            <ol class="comment-threads top-level " id="page-comments">
                        <li id="comment-thread-13107201" class="comment-thread">
                                <div class="comment  " id="comment-13107201">
                <p class="comment-user-logo">
                    <img class="userLogo logo anonymous" src="../../s/en_GB/3047/3/_/images/icons/profilepics/anonymous.png"
           alt="User icon: hiredman" title="hiredman">                </p>
                <p class="date" title="Feb 17, 2016 00:13">
                    Feb 17, 2016
                </p>
                <div class="comment-header">
                    <h4 class="author"><a href="../../login.action-os_destination=-display-~hiredman.html"
                          class="url fn"
                   >Kevin Downey</a></h4>
                </div>
                <div class="comment-body">
                    <div class="comment-content wiki-content">
                        <p>Are there any benchmarks of how fast the jvm loads classes? I think it would be interesting to see how long it takes to load a namespace with lots of metadata and vars but not loading any other classes vs. a namespace with all the metadata and vars and functions that cause other classes to be loaded.</p>
                    </div>
                    <div class="comment-actions">
                                                      <ul class="comment-actions-secondary">
                                                          <li class="first comment-permalink">
            <a title="Permanent link to this comment" href="Improving+Clojure+Start+Time-focusedCommentId=13107201.html#comment-13107201"
                id="comment-permalink-13107201"                ><span>Permalink</span></a></li>
            </ul>
                                <ul class="comment-actions-primary">
            </ul>
                      </div>
                </div>
            </div>

            <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
         <rdf:Description
    rdf:about="Improving+Clojure+Start+Time-focusedCommentId=13107201.html#comment-13107201"
    dc:identifier="Improving+Clojure+Start+Time-focusedCommentId=13107201.html#comment-13107201"
    dc:title="Improving Clojure Start Time"
    trackback:ping="https://dev.clojure.org/rpc/trackback/13107201"/>
</rdf:RDF>
-->

                    
                                    <ol class="comment-threads">
                                        <li id="comment-thread-13107202" class="comment-thread">
                                <div class="comment  " id="comment-13107202">
                <p class="comment-user-logo">
                    <img class="userLogo logo anonymous" src="../../s/en_GB/3047/3/_/images/icons/profilepics/anonymous.png"
           alt="User icon: hiredman" title="hiredman">                </p>
                <p class="date" title="Feb 17, 2016 01:22">
                    Feb 17, 2016
                </p>
                <div class="comment-header">
                    <h4 class="author"><a href="../../login.action-os_destination=-display-~hiredman.html"
                          class="url fn"
                   >Kevin Downey</a></h4>
                </div>
                <div class="comment-body">
                    <div class="comment-content wiki-content">
                        <p>This is kind of a loaded question, because I wonder if the jvm would load a big class with a bunch of static methods faster than many classes. If that is the case, many clojure functions could be compiled into a static method on the enclosing namespace when aot compiling, with semantics similar to direct linking. This would get rid of the lazy load check that the jvm has trouble inlining. The tradeoff is, if you do need those functions as values invoking is likely to be slower likely through reflection in some kind of wrapper over the static methods. Maybe invokedynamic would solve that (just like lazy loading)</p>
                    </div>
                    <div class="comment-actions">
                                                      <ul class="comment-actions-secondary">
                                                          <li class="first comment-permalink">
            <a title="Permanent link to this comment" href="Improving+Clojure+Start+Time-focusedCommentId=13107202.html#comment-13107202"
                id="comment-permalink-13107202"                ><span>Permalink</span></a></li>
            </ul>
                                <ul class="comment-actions-primary">
            </ul>
                      </div>
                </div>
            </div>

            <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
         <rdf:Description
    rdf:about="Improving+Clojure+Start+Time-focusedCommentId=13107202.html#comment-13107202"
    dc:identifier="Improving+Clojure+Start+Time-focusedCommentId=13107202.html#comment-13107202"
    dc:title="Improving Clojure Start Time"
    trackback:ping="https://dev.clojure.org/rpc/trackback/13107202"/>
</rdf:RDF>
-->

                    
                                </li>
                                        <li id="comment-thread-13107205" class="comment-thread">
                                <div class="comment  " id="comment-13107205">
                <p class="comment-user-logo">
                    <img class="userLogo logo anonymous" src="../../s/en_GB/3047/3/_/images/icons/profilepics/anonymous.png"
           alt="User icon: hiredman" title="hiredman">                </p>
                <p class="date" title="Feb 17, 2016 15:05">
                    Feb 17, 2016
                </p>
                <div class="comment-header">
                    <h4 class="author"><a href="../../login.action-os_destination=-display-~hiredman.html"
                          class="url fn"
                   >Kevin Downey</a></h4>
                </div>
                <div class="comment-body">
                    <div class="comment-content wiki-content">
                        <p>This may be common knowledge, but I did a little benchmark and loading one class that causes 1000 classes (from a jar) seems to almost always be faster than loading 1 class with 1000 static methods(with various openjdk versions on linux). I don't know why.</p><p>So lifting fn bodies in to static methods doesn't seem like it would improve start up time.</p>
                    </div>
                    <div class="comment-actions">
                                                      <ul class="comment-actions-secondary">
                                                          <li class="first comment-permalink">
            <a title="Permanent link to this comment" href="Improving+Clojure+Start+Time-focusedCommentId=13107205.html#comment-13107205"
                id="comment-permalink-13107205"                ><span>Permalink</span></a></li>
            </ul>
                                <ul class="comment-actions-primary">
            </ul>
                      </div>
                </div>
            </div>

            <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
         <rdf:Description
    rdf:about="Improving+Clojure+Start+Time-focusedCommentId=13107205.html#comment-13107205"
    dc:identifier="Improving+Clojure+Start+Time-focusedCommentId=13107205.html#comment-13107205"
    dc:title="Improving Clojure Start Time"
    trackback:ping="https://dev.clojure.org/rpc/trackback/13107205"/>
</rdf:RDF>
-->

                    
                                </li>
                                </ol>
                        </li>
                        <li id="comment-thread-13107285" class="comment-thread">
                                <div class="comment  " id="comment-13107285">
                <p class="comment-user-logo">
                    <img class="userLogo logo anonymous" src="../../s/en_GB/3047/3/_/images/icons/profilepics/anonymous.png"
           alt="User icon: hiredman" title="hiredman">                </p>
                <p class="date" title="Feb 24, 2016 15:29">
                    Feb 24, 2016
                </p>
                <div class="comment-header">
                    <h4 class="author"><a href="../../login.action-os_destination=-display-~hiredman.html"
                          class="url fn"
                   >Kevin Downey</a></h4>
                </div>
                <div class="comment-body">
                    <div class="comment-content wiki-content">
                        <p>It seems like parallel code loading is off the table without a huge amount of work. Loading clojure code is just so free form and permitting of so many effects (some even baked in like defmethod)</p>
                    </div>
                    <div class="comment-actions">
                                                      <ul class="comment-actions-secondary">
                                                          <li class="first comment-permalink">
            <a title="Permanent link to this comment" href="Improving+Clojure+Start+Time-focusedCommentId=13107285.html#comment-13107285"
                id="comment-permalink-13107285"                ><span>Permalink</span></a></li>
            </ul>
                                <ul class="comment-actions-primary">
            </ul>
                      </div>
                </div>
            </div>

            <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
         <rdf:Description
    rdf:about="Improving+Clojure+Start+Time-focusedCommentId=13107285.html#comment-13107285"
    dc:identifier="Improving+Clojure+Start+Time-focusedCommentId=13107285.html#comment-13107285"
    dc:title="Improving Clojure Start Time"
    trackback:ping="https://dev.clojure.org/rpc/trackback/13107285"/>
</rdf:RDF>
-->

                    
                                </li>
                </ol>
    
    </div>


            
</div>


    



    
    

    
    
    


    



    <br class="clear">
</div>
  
    </div>
</div>

<div id="footer">
                                                <p class="license license-opensource">
                  Powered by a free <b>Atlassian Confluence Open Source Project License</b> granted to Clojure. <a href="http://www.atlassian.com/c/conf/11461">Evaluate Confluence today</a>.<br>
                </p>
                        
    <ul id="poweredby">
        <li class="noprint">Powered by <a href="http://www.atlassian.com/software/confluence" class="hover-footer-link">Atlassian Confluence</a> <span id='footer-build-information'>4.0</span>, the <a href="http://www.atlassian.com/software/confluence/tour/enterprise-wiki.jsp" class="hover-footer-link">Enterprise Wiki</a></li>
        <li class="print-only">Printed by Atlassian Confluence 4.0, the Enterprise Wiki.</li>        
        <li class="noprint"> &nbsp; |&nbsp; <a href="http://jira.atlassian.com/secure/BrowseProject.jspa?id=10470" class="hover-footer-link">Report a bug</a></li>
        <li class="noprint"> &nbsp;|&nbsp; <a href="http://www.atlassian.com/about/connected.jsp?s_kwcid=Confluence-stayintouch" class="hover-footer-link">Atlassian News</a></li>
    </ul>

    

            <div><span style="">Site support by</span><a href="http://contegix.com"> <img style="vertical-align:middle" src="../../download/attachments/459015/contegix.jpg.html"/></a></div>
    </div></div>
</body>
</html>
